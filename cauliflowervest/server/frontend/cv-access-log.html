<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../iron-ajax/iron-ajax.html">
<link rel="import" href="../iron-icon/iron-icon.html">
<link rel="import" href="../iron-icons/iron-icons.html">
<link rel="import" href="../paper-icon-button/paper-icon-button.html">
<link rel="import" href="../paper-spinner/paper-spinner.html">

<dom-module id="cv-access-log">
  <template>
    <style is="custom-style">
      paper-icon-button.blue {
        --paper-icon-button-ink-color: var(--paper-orange-500);
        background-color: var(--paper-light-blue-500);
        color: white;
        border-radius: 50%;
      }
    </style>
    <iron-localstorage
        name="showOnlyErrorsInLogs[[logType]]" value="{{parsedState_.showOnlyErrors}}">
    </iron-localstorage>
    <iron-ajax
        id="request" url="/logs?log_type=[[logType]]&start_next=[[parsedState_.start]]&only_errors=[[parsedState_.showOnlyErrors]]"
        on-response="onResponse_" on-error="onNetworkError_" json-prefix=")]}',&#010;"
        loading="{{loading_}}" handle-as="json">
    </iron-ajax>
    <template is="dom-if" if="[[loading_]]" restamp>
      <paper-spinner active></paper-spinner>
    </template>
    <template is="dom-if" if="[[!loading_]]" restamp>
      <paper-checkbox checked="{{parsedState_.showOnlyErrors}}" style="float: right;">
        Show only errors
      </paper-checkbox>
      <table>
        <tr>
          <th>Time (UTC)</th>
          <th>User</th>
          <th>Message</th>
          <th>Success</th>
          <th>Query</th>
        </tr>
        <template is="dom-repeat" items="[[logs_]]" as="log">
          <tr>
            <td style="white-space: nowrap;">[[log.mtime]]</td>
            <td>[[log.user]]</td>
            <td>[[log.message]]</td>
            <td>[[log.successful]]</td>
            <td>[[log.query]]</td>
          </tr>
        </template>
      </table>
      <template is="dom-if" if="[[next_]]" restamp>
        <p>
          <paper-icon-button class="blue" style="float:right; margin-bottom:20px;" icon="icons:chevron-right" on-click="showNextPage_">
          </paper-icon-button>
        </p>
      </template>
    </template>
  </template>
  <script src="cv-access-log.js"></script>
</dom-module>
